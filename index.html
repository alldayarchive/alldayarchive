<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="seo-title">AllDay Archive | Global Intelligence Hub</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --gold: #F5C97A; --bg: #0c0e12; --text-main: #E5E7EB; --text-sub: #9CA3AF; --text-meta: #6B7280; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg); color: var(--text-main); font-size: 16px; line-height: 1.65; scroll-behavior: smooth; overflow-x: hidden; }
        .font-serif { font-family: 'Playfair Display', serif; }
        .bg-heritage { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle at 50% 50%, #1a202c 0%, #0c0e12 100%); z-index: -1; }
        .glass-card { background: rgba(25, 28, 35, 0.98); border: 1px solid rgba(245, 201, 122, 0.15); border-radius: 24px; padding: 2rem; transition: 0.4s; }
        .scroll-box { height: 420px; overflow-y: auto; padding-right: 10px; scrollbar-width: thin; scrollbar-color: var(--gold) transparent; }
        .scroll-box::-webkit-scrollbar { width: 3px; }
        .scroll-box::-webkit-scrollbar-thumb { background: var(--gold); border-radius: 10px; }

        a { color: var(--gold); font-weight: 700; text-decoration: none; }
        .priority-focus { background: rgba(245, 201, 122, 0.18) !important; border-left: 5px solid var(--gold) !important; transform: scale(1.01); }
        
        input { background: rgba(255,255,255,0.1) !important; border: 1px solid rgba(245, 201, 122, 0.3) !important; padding: 1.1rem; border-radius: 12px; color: #fff !important; outline: none; width: 100%; text-align: center; font-size: 1rem; }
        .date-hub input { width: 90px; }
        .scan-btn { background: var(--gold); color: #000; font-weight: 900; padding: 1.2rem; border-radius: 12px; width: 100%; text-transform: uppercase; cursor: pointer; transition: 0.3s; }
        
        .action-btn { font-size: 8px; font-weight: 800; padding: 4px 8px; border: 1px solid rgba(255,255,255,0.1); border-radius: 4px; color: var(--text-sub); background: rgba(0,0,0,0.3); cursor: pointer; }
        .year-badge { border: 1px solid var(--gold); color: var(--gold); padding: 2px 6px; border-radius: 4px; font-size: 10px; min-width: 60px; text-align: center; }
        .day-label { font-size: 9px; color: var(--text-meta); font-weight: 800; margin-right: 5px; }

        /* üí° ÏàòÏùµÌôî Ìè¨Ïù∏Ìä∏ Ïä§ÌÉÄÏùº */
        .premium-pdf-btn { background: linear-gradient(to right, #c5a059, #F5C97A); color: #000; font-weight: 900; padding: 0.8rem 1.5rem; border-radius: 50px; font-size: 12px; cursor: pointer; }
        .pack-buy-btn { font-size: 9px; background: rgba(245, 201, 122, 0.1); color: var(--gold); border: 1px solid var(--gold); padding: 2px 8px; border-radius: 20px; float: right; }
        
        .detail-view { display: none; padding: 1rem; margin-top: 10px; background: rgba(255,255,255,0.03); border-radius: 12px; font-size: 13px; color: #B5B5B5; border: 1px dashed var(--gold); text-align: left; }
        .ad-area { min-height: 100px; background: rgba(255,255,255,0.02); border: 1px dashed rgba(255,255,255,0.1); display: flex; align-items: center; justify-content: center; color: var(--text-meta); font-size: 10px; border-radius: 16px; margin: 2rem 0; }
        .star-map { background: radial-gradient(circle, #1e293b 0%, #000 100%); border-radius: 50%; width: 100px; height: 100px; margin: 0 auto; border: 1px solid var(--gold); position: relative; overflow: hidden; }
        .star { position: absolute; background: white; border-radius: 50%; opacity: 0.8; animation: twinkle 2s infinite; }
        #vault-area { display: none; }
    </style>
</head>
<body>
    <div class="bg-heritage"></div>
    
    <nav class="fixed w-full z-[1000] px-10 py-6 border-b border-white/5 bg-black/40 backdrop-blur-xl">
        <div class="text-2xl font-black text-[#F5C97A] uppercase italic tracking-tighter">ALLDAY ARCHIVE</div>
    </nav>

    <main class="relative pt-48 pb-20 px-6 max-w-7xl mx-auto space-y-12 text-center">
        <!-- üéØ Search & Personalization -->
        <section class="space-y-10">
            <h1 class="text-6xl md:text-9xl font-black text-white leading-none font-serif italic uppercase tracking-tighter italic">HISTORY <br><span class="text-[#F5C97A]">INTELLIGENCE</span></h1>
            <div class="glass-card max-w-5xl mx-auto p-8 shadow-3xl space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <input type="text" id="smartSearch" placeholder="KEYWORD (NASA, WAR...)">
                    <input type="text" id="countrySearch" placeholder="NATION (EMPTY = AUTO)">
                    <input type="text" id="personalDay" placeholder="MY DAY (NAME, MM-DD)">
                </div>
                <div class="date-hub flex gap-3 justify-center">
                    <input type="text" id="in-year" placeholder="YYYY" maxlength="4" oninput="if(this.value.length==4)document.getElementById('in-month').focus()">
                    <input type="text" id="in-month" placeholder="MM" maxlength="2" oninput="if(this.value.length==2)document.getElementById('in-day').focus()">
                    <input type="text" id="in-day" placeholder="DD" maxlength="2">
                </div>
                <button id="scanBtn" onclick="handleScan()" class="scan-btn">Synchronize Intelligence (Enter)</button>
            </div>
        </section>

        <div class="ad-area">Sponsored Content (TOP)</div>

        <div id="vault-area" class="space-y-20">
            <!-- HUD Dash -->
            <section class="grid grid-cols-1 md:grid-cols-4 gap-6 text-center">
                <div class="glass-card border-t-2 border-sky-500 py-8"><span class="text-[9px] text-sky-400 uppercase font-bold">Atmosphere</span><div id="disp-weather" class="text-4xl font-black italic mt-2">--¬∞C</div></div>
                <div class="glass-card border-t-2 border-white/20 py-8"><span class="text-[9px] uppercase font-bold">Day of Week</span><div id="disp-day" class="text-xl font-black text-white mt-2 uppercase">--</div></div>
                <div class="glass-card border-t-2 border-[#F5C97A] py-8"><span class="text-[9px] text-[#F5C97A] uppercase font-bold">Stellar View</span><div class="star-map mt-2" id="star-container"></div></div>
                <div class="glass-card border-t-2 border-emerald-500 py-8"><span class="text-[9px] text-emerald-400 uppercase font-bold">Ancestral Cycle</span><div id="disp-ganji" class="text-lg font-black text-white mt-2">--</div></div>
            </section>

            <!-- üí∞ [ÏàòÏùµÌôî 9Î≤à] PDF ÏÉÅÌíàÌôî ÏÑπÏÖò -->
            <section id="priority-section" class="space-y-4 hidden text-left">
                <div class="flex justify-between items-center border-b border-white/5 pb-4">
                    <h2 class="text-3xl font-serif text-white italic uppercase tracking-widest"><span class="text-[#F5C97A]">Intelligence</span> Priority Result</h2>
                    <div class="flex gap-2">
                        <button onclick="startCheckout('annual_full')" class="premium-pdf-btn">üìÑ Get Annual PDF Report</button>
                    </div>
                </div>
                <div id="list-priority" class="space-y-4"></div>
            </section>

            <!-- üèÜ [ÏàòÏùµÌôî 8Î≤à] Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ ÏÉÅÌíà Ïó∞Í≥Ñ Î≤ÑÌäº Ï∂îÍ∞Ä -->
            <section class="glass-card p-8 border-t-4 border-[#F5C97A] text-left">
                <button onclick="startCheckout('pack_sports')" class="pack-buy-btn">Sports Pack PDF ‚Üí</button>
                <h2 class="text-2xl font-serif text-[#F5C97A] italic mb-6 uppercase tracking-widest font-bold">üèÜ Sports & Olympic Milestones</h2>
                <div id="list-sports" class="scroll-box space-y-4"></div>
            </section>

            <section class="glass-card p-8 border-t-4 border-slate-500 text-left">
                <button onclick="startCheckout('pack_law')" class="pack-buy-btn">Justice Pack PDF ‚Üí</button>
                <h2 class="text-2xl font-serif text-slate-400 mb-6 uppercase tracking-widest font-bold">‚öñÔ∏è Law & Justice</h2>
                <div id="list-law" class="scroll-box space-y-4"></div>
            </section>

            <div class="ad-area">Sponsored Content (MIDDLE)</div>

            <section class="glass-card p-8 border-t-4 border-emerald-500 text-left">
                <button onclick="startCheckout('pack_finance')" class="pack-buy-btn">Finance Pack PDF ‚Üí</button>
                <h2 class="text-2xl font-serif text-emerald-400 mb-6 uppercase tracking-widest font-bold">üìà Finance & Wealth Records</h2>
                <div id="list-finance" class="scroll-box space-y-4"></div>
            </section>

            <!-- ... Í∏∞ÌÉÄ ÏÑπÏÖòÎì§ (Í∏∞Ï°¥ Íµ¨Ï°∞ Ïú†ÏßÄ) ... -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 text-left">
                <div class="glass-card p-6 border-t-4 border-sky-400"><h3>üé¨ Movies</h3><div id="list-movies" class="scroll-box h-[250px]"></div></div>
                <div class="glass-card p-6 border-t-4 border-pink-500"><h3>üéµ Music</h3><div id="list-music" class="scroll-box h-[250px]"></div></div>
                <div class="glass-card p-6 border-t-4 border-amber-500"><h3>üéÆ Gaming</h3><div id="list-gaming" class="scroll-box h-[250px]"></div></div>
                <div class="glass-card p-6 border-t-4 border-emerald-400"><h3>üìö Literature</h3><div id="list-books" class="scroll-box h-[250px]"></div></div>
            </div>

            <div class="ad-area">Premium Discovery Sponsored Area (BOTTOM)</div>

            <footer class="py-24 text-center border-t border-white/5 bg-black/20 space-y-12">
                <div class="flex flex-col items-center gap-6">
                    <button onclick="window.open('https://buymeacoffee.com/djawjdaks8g')" class="bg-[#FFDD00] text-black px-8 py-3 rounded-full font-black text-xs hover:scale-105 transition-all shadow-2xl uppercase tracking-widest">‚òï Buy me a coffee</button>
                    <button onclick="window.open('https://alldayarchive.blogspot.com')" class="bg-emerald-600 text-white px-10 py-4 rounded-full font-black text-xs hover:bg-white hover:text-black transition-all shadow-xl uppercase italic tracking-widest">Enter Chronicles Library (Blog)</button>
                </div>
                <div class="pt-10 space-y-2">
                    <p class="text-[9px] text-gray-600 uppercase tracking-[0.5em] italic">Discovery Engine curated by dedle ¬© 2026</p>
                </div>
            </footer>
        </div>
    </main>

    <script>
        const SB_URL = "https://iwgjfplrqeupfppcqmau.supabase.co"; 
        const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml3Z2pmcGxycWV1cGZwcGNxbWF1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc2ODMzODMsImV4cCI6MjA4MzI1OTM4M30.mW07xEhx-YvSx-Xe2YSUH6TpaXEwdvGdbBBcQy1sitU"; 
        const sb = supabase.createClient(SB_URL, SB_KEY);
        const AMAZON_ID = "dedle-20";
        
        // üí° [7Î≤à] Íµ≠Í∞Ä ÏûêÎèô Í∞êÏßÄ Î°úÏßÅ
        const DEFAULT_COUNTRY = navigator.language?.split('-')[1]?.toUpperCase() || "US";

        let isScanning = false;
        let COUNTRIES = [];
        let countriesLoaded = false;

        fetch("https://restcountries.com/v3.1/all").then(r => r.json()).then(data => {
            COUNTRIES = data.map(c => ({ code: c.cca2, names: [c.name.common, ...(c.altSpellings||[])].map(v=>v.toLowerCase()) }));
            countriesLoaded = true;
        });

        // üí° [10Î≤à] Paddle Í≤∞Ï†ú Ïó∞Îèô ÏóîÏßÑ (Stub)
        function startCheckout(productId) {
            console.log(`Starting Paddle Checkout for: ${productId}`);
            alert(`Redirecting to Paddle Checkout for Product: ${productId}\n(Webhook will trigger PDF Generation)`);
            // window.Paddle.Checkout.open({ product: productId });
        }

        async function handleScan() {
            if (isScanning || !countriesLoaded) return;
            isScanning = true;

            const inY = document.getElementById('in-year').value;
            const inM = document.getElementById('in-month').value.padStart(2,'0');
            const inD = document.getElementById('in-day').value.padStart(2,'0');
            const kw = document.getElementById('smartSearch').value.trim().toLowerCase();
            const coInput = document.getElementById('countrySearch').value.trim().toLowerCase();

            // üí° [7Î≤à] Íµ≠Í∞Ä ÌåêÎ≥Ñ (Auto vs Manual)
            let detectedCo = "";
            let isAuto = true;
            if (coInput) {
                const found = COUNTRIES.find(c => c.names.some(n => coInput.includes(n)));
                if (found) { detectedCo = found.code; isAuto = false; }
            }
            const finalCo = detectedCo || DEFAULT_COUNTRY;
            const urlCo = isAuto ? 'auto' : finalCo.toLowerCase();
            window.history.replaceState({}, "", `/${urlCo}/${inM}-${inD}`);

            let query = sb.from('daily_archives').select('*');
            if (inM !== "00") query = query.like('date_id', `${inM}-%`);

            const { data, error } = await query.order('date_id', {ascending: true});

            if (!error && data) renderAll(data, inY, finalCo, kw, isAuto);
            isScanning = false;
        }

        function toggleDetail(id) {
            const el = document.getElementById(id);
            el.style.display = (el.style.display === 'block') ? 'none' : 'block';
        }

        function renderAll(data, inY, finalCo, kw, isAuto) {
            document.getElementById('vault-area').style.display = 'block';
            const priorityList = [];

            const render = (id, list, type) => {
                const cont = document.getElementById(id); cont.innerHTML = "";
                
                // üí° [6Î≤à] Ï†ïÎ†¨ Î°úÏßÅ ÏµúÏ†ÅÌôî (Íµ≠Í∞Ä Ïö∞ÏÑ† -> Í∏ÄÎ°úÎ≤å)
                let filtered = list.filter(item => !kw || item.text.toLowerCase().includes(kw));

                filtered.sort((a,b) => {
                    // 1ÏàúÏúÑ: ÎÇ¥ Íµ≠Í∞Ä Îç∞Ïù¥ÌÑ∞
                    const aIsCo = a.country_code === finalCo;
                    const bIsCo = b.country_code === finalCo;
                    if (aIsCo && !bIsCo) return -1;
                    if (!aIsCo && bIsCo) return 1;
                    // 2ÏàúÏúÑ: Í≤ÄÏÉâ Ïó∞ÎèÑ Îß§Ïπ≠
                    return (b.year == inY) - (a.year == inY) || (b.year - a.year);
                }).forEach((item, idx) => {
                    const isCo = item.country_code === finalCo;
                    const isY = inY && item.year == inY;
                    const detailId = `detail-${type}-${idx}`;
                    const q = encodeURIComponent(item.text);

                    const html = `
                        <div class="py-4 border-b border-white/5 ${isCo && isY && kw ? 'priority-focus px-4 rounded-lg' : ''}">
                            <div class="flex items-start gap-4">
                                <div class="flex flex-col gap-1">
                                    <span class="day-label">${item.date_id}</span>
                                    <span class="year-badge ${isY ? 'match-badge' : ''}">${item.year || 'SPEC'}</span>
                                </div>
                                <div class="flex-1">
                                    <div class="text-sm text-[#E2E2E2] leading-relaxed">
                                        ${item.text} 
                                        <button onclick="toggleDetail('${detailId}')" class="text-[10px] text-[#F5C97A] font-black ml-2">[+] Detail</button>
                                    </div>
                                    <div id="${detailId}" class="detail-view">
                                        Verified intelligence background. <a href="https://alldayarchive.blogspot.com/search?q=${q}" target="_blank" class="underline">Read full analysis on Blog</a>
                                    </div>
                                    <div class="flex flex-wrap gap-2 mt-3">
                                        <button onclick="window.open('https://www.youtube.com/results?search_query=${q}')" class="action-btn">üì∫ Youtube</button>
                                        <button onclick="window.open('https://www.amazon.com/s?tag=${AMAZON_ID}&k=${q}')" class="action-btn">üõí Amazon</button>
                                        <button onclick="window.open('https://alldayarchive.blogspot.com/search?q=${q}')" class="action-btn">üìÑ Chronicle</button>
                                    </div>
                                </div>
                            </div>
                        </div>`;
                    if (isCo && isY && kw) priorityList.push(html);
                    cont.innerHTML += html;
                });
            };

            const allEvents = data.flatMap(d => {
                const events = [...(d.firsts || []), ...(d.holidays || [])];
                return events.map(e => ({ ...e, date_id: d.date_id, country_code: d.country_code }));
            });

            render('list-sports', allEvents, 'sports');
            render('list-law', allEvents, 'law');
            render('list-finance', allEvents, 'finance');
            render('list-incidents', allEvents, 'incidents');
            render('list-movies', allEvents, 'movies');
            render('list-music', allEvents, 'music');
            render('list-gaming', allEvents, 'gaming');
            render('list-books', allEvents, 'books');

            if (priorityList.length > 0) {
                document.getElementById('priority-section').classList.remove('hidden');
                document.getElementById('list-priority').innerHTML = priorityList.slice(0, 5).join('');
            }
            // HUD ÏóÖÎç∞Ïù¥Ìä∏...
        }
    </script>
</body>
</html>
